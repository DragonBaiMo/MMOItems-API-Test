# DO NOT TOUCH
config-version: 8

# Notifies players with the 'mmoitems.update-notify' perm node when
# they join the server if a new update is available for download.
# Changes apply on server restart.
update-notify: true

# Enable/disable the plugin iterating over the whole player inventory
# instead of just the players armor and held items.
# This option is required for the Ornament item type, however
# it CAN cause lag and/or take a lot of memory.
iterate-whole-inventory: false

# When this is set to true, skins can only be applied to an item ONCE. 
locked-skins: true

# Since 6.9.3 dev builds, MMOItems supports the use of multiple
# RPG core plugins at the same time. However, MMOItems needs one
# specific plugin to hook onto level, class, etc.
#
# Available plugins:
# - MMOCORE (level, class, mana, stamina)
# - HEROES (level, class, mana, stamina)
# - FABLED (level, class, mana)
# - RPGPLAYERLEVELING (level, mana, power)
# - RACESANDCLASSES (level, class, mana)
# - BATTLELEVELS (level)
# - MCMMO (power level)
# - MCRPG (power level)
# - SKILLS or SKILLSPRO (class, level, mana)
# - AURELIUM_SKILLS (version 1.X: power level, mana)
# - AURA_SKILLS (version 2+: power level, mana)
preferred-rpg-provider: MMOCORE

# By default, all player inventories will be updated every
# 10 ticks which corresponds to 2 inventory updates a second.
inventory-update-delay: 10

# When generating an item, the item level
# must match approximately the player level
# otherwise the player cannot use items/get useless items.
#
# The item level is always somewhere in the
# interval [playerLevel - spread, playerLevel + spread]
item-level-spread: 2

# When using WorldGuard, these flag checks can sometimes be
# performance expensive. If you are running WorldGuard but are
# not using some of these flags, you can toggle off checks here
# to increase performance.
#
# More information about WorldGuard flags:
# https://gitlab.com/phoenix-dvpmt/mythiclib/-/wikis/Plugin-Compatibility#flag-plugins
enable_flag_checks:
    commands: true
    weapons: true
    consumables: true
    tools: true

consumables:

    # Toggled off by default. When set to true, right-clicking
    # a consumable will NOT consume it if the player is looking
    # at an interactable block (chests, crafting tables...).
    # Only available in Spigot 1.21+
    disable_clicks_on_blocks: false

durability:

    # Armor durability is deduced as follows: for every 4 pts
    # of damage tanked by the player, one durability point is
    # taken off the item. There is no upper limit on the amount
    # of durability points taken off simultaneously. While this is
    # fine with vanilla Minecraft, when doing super fancy skills that
    # deal tons of damage, armor pieces can be broken in one hit,
    # causing major gameplay problems.
    #
    # This option sets a cap on the amount of durability lost at once.
    # Set it to 0 to disable this option. It is disabled by default
    # to not interfere with the default vanilla behaviour.
    #
    # More info on how many durability points are lost when performing
    # specific actions on the Minecraft Wiki:
    # https://minecraft.fandom.com/wiki/Durability
    loss_cap: 0

    # 当使用 mmodamage 等技能型伤害时，是否扣除主手物品的自定义耐久。
    # 设为 false 可完全关闭该功能。
    mmo_damage_loss: true

# An item with no tier will use this tier name
# as its default tier name.
default-tier-name: 'Common'

# When an item is generated with no tier,
# this is the capacity formula it will use.
default-item-capacity:
    base: 3
    scale: 0
    spread: 0
    max-spread: 0

# Changes the default value for some stats. This mainly
# accounts for untargeted weapons like staffs, muskets...
default:
    attack-speed: 0.67 # For legacy ranged weapons only (lutes and muskets...). Will be removed in the future
    range: 16
    recoil: 0.1

# Changes apply on server restart.
dropped-items:

    # Items glow based on their tier
    tier-glow: true

    # Display item name over the dropped item
    hints: true

# Toggle off to disable item permissions altogether.
# Along with item commands, this stat can cause serious security
# problems if given access to staff members/admins. If you don't
# plan on using this stat, you can consider disabling it altogether.
enable_item_granted_permissions: true

item_commands:

  # Toggle off to disable item commands altogether.
  # Along with item commands, this stat can cause serious security
  # problems if given access to staff members/admins. If you don't
  # plan on using this stat, you can consider disabling it altogether.
  enabled: true

  # List of regex patterns for item command whitelist.
  # For additional security, carefully choose a subset of
  # commands to be executed by item commands. Any command that
  # does not match any pattern in this list will not be executable.
  # Some regex pattern examples:
  # - "dm open .*" matches any command that STARTS with "dm open"
  # - ".*hello world" matches any command that ENDS with "hello world"
  # - "hat" matches the exact command "hat"
  # Leave it to [] to disable whitelist
  whitelist: []

# Some item stats like 'Commands' or NBTTags can be abused to become op.
# You can bind a specific permissions to these stats to limit their edition.
# You need a perm plugin that supports Vault for that option to work.
# The corresponding permission is "mmoitems.edit.op".
op-item-stats:
    enabled: false
    stats:
        - COMMANDS
        - CUSTOM_NBT
        - GRANTED_PERMISSIONS

item-upgrading:

    # Display name suffix for upgraded items.
    name-suffix: ' &8(&e+#lvl#&8)'

    # Whether to display in Item Name or Lore
    # Disable if item renaming is available to players.
    # If set to 'false', remember to include
    # {upgrade_level} in your item lore.
    display-in-name: true

    # Whether or not to display which
    # stats are changed in the lore.
    display-stat-changes: false
    stat-change-suffix: ' &8(<p>#stat#&8)'
    stat-change-positive: '&a'
    stat-change-negative: '&c'

    # ===== 保底机制配置 =====
    # 同一物品连续强化失败达到阈值后，下次强化必定成功
    guarantee:
        # 是否启用保底机制
        enabled: true
        # 连续失败多少次后触发保底（默认30次）
        threshold: 30
        # 强化成功后是否重置失败计数
        reset-on-success: true
        # 失败计数过期时间（小时，<=0 表示不过期；例如 24 表示 24 小时内不强化则计数清零）
        expire-hours: 0

    # ===== 每日限制配置 =====
    # 限制玩家每天的强化次数
    daily-limit:
        # 是否启用每日限制（默认关闭）
        enabled: false
        # 默认每日最大强化次数
        default-max: 50
        # 每日重置时间（0-23小时，0表示凌晨0点）
        reset-hour: 0
        # 绕过限制的权限节点
        bypass-permission: "mmoitems.upgrade.bypass-daily"
        # 是否将每日计数持久化到磁盘（文件：plugins/MMOItems/upgrade-daily-limit.yml）
        persist-enabled: true
        # 权限分档配置（优先级高的先匹配）
        # 用于按权限配置不同玩家的每日上限
        tiers:
            svip:
                permission: "mmoitems.upgrade.limit.svip"
                max: 200
                priority: 30
            vip:
                permission: "mmoitems.upgrade.limit.vip"
                max: 100
                priority: 20
            # default 分档无需 permission，匹配所有玩家
            default:
                permission: ""
                max: 50
                priority: 0

    # ===== 经济消耗配置 =====
    # 强化时扣除金币/点券（需安装 DrcomoCoreLib）
    economy-cost:
        # 是否启用经济消耗（默认关闭）
        enabled: false
        # 经济类型: vault（金币）或 playerpoints（点券）
        type: "vault"
        # 按等级段配置费用
        # 格式："起始等级-结束等级": 费用
        tiers:
            "0-5": 100
            "6-10": 500
            "11-15": 2000
            "16-20": 5000
            # 未匹配到等级段时使用此默认值
            "default": 100

    # ===== 强化后自动绑定配置 =====
    # 强化成功后自动将物品绑定给强化者
    auto-bind-on-upgrade:
        # 是否启用强化后自动绑定（默认关闭）
        enabled: false
        # 绑定等级（1-7，等级越高解绑越难）
        level: 1
        # 是否显示绑定消息
        show-message: true

    # ===== 全服通报配置 =====
    # 当玩家强化到指定等级时全服广播
    broadcast:
        # 是否启用全服通报（默认关闭）
        enabled: false
        # 触发通报的等级列表
        levels:
            - 12
            - 15
            - 20
            - 25
            - 30
        # 通报消息格式
        # 占位符: {player} = 玩家名, {item} = 物品名, {level} = 强化等级
        message: "&6[强化通报] &a{player} 的 &e{item}&a 强化到 &c+{level}&a 级！"

    # ===== 强化特效配置 =====
    # 强化成功/失败时的视觉效果
    effects:
        # 是否启用特效（默认开启）
        enabled: true
        # 成功特效
        success:
            # 粒子效果（Bukkit Particle 枚举名）
            particle: "VILLAGER_HAPPY"
            # 粒子数量
            particle-count: 30
            # 音效（Bukkit Sound 枚举名或 MythicLib 音效）
            sound: "ENTITY_PLAYER_LEVELUP"
            # 音量
            volume: 1.0
            # 音调
            pitch: 1.5
        # 失败特效
        failure:
            particle: "SMOKE_NORMAL"
            particle-count: 20
            sound: "ENTITY_ITEM_BREAK"
            volume: 1.0
            pitch: 1.0
        # 碎裂特效
        break:
            particle: "EXPLOSION_LARGE"
            particle-count: 1
            sound: "ENTITY_GENERIC_EXPLODE"
            volume: 1.0
            pitch: 0.5
        # 保底触发特效
        guarantee:
            particle: "TOTEM"
            particle-count: 50
            sound: "UI_TOAST_CHALLENGE_COMPLETE"
            volume: 1.0
            pitch: 1.0
        # 特效权限控制（无权限则不显示粒子，只播放音效）
        particle-permission: ""
        # 按等级段配置额外特效（高等级成功时更华丽）
        level-effects:
            # 15级以上成功时额外特效
            "15+":
                particle: "FIREWORKS_SPARK"
                particle-count: 50
            # 20级以上成功时额外特效
            "20+":
                particle: "END_ROD"
                particle-count: 100

    # ===== 强化日志配置 =====
    # 记录所有强化操作的日志，支持查询和分析
    upgrade-log:
        # 是否启用强化日志（默认关闭）
        enabled: false
        # 日志保留天数（超过后自动清理）
        retention-days: 30

    # ===== 额外概率加成配置 =====
    # 支持通过 PAPI 变量、权限节点计算额外成功率加成
    # 需要 DrcomoCoreLib 支持公式计算
    chance-bonus:
        # 是否启用额外概率加成（默认关闭）
        enabled: false
        # 概率加成公式（支持 PAPI 变量和数学表达式）
        # 可用变量：
        #   %player_level% - 玩家等级（需要 PAPI + 等级插件）
        #   %mmoitems_upgrade_level% - 当前强化等级
        #   %vault_eco_balance% - 玩家金币余额
        #   自定义变量...
        # 公式结果表示额外成功率加成（百分比）
        # 例如：结果为 10 表示 +10% 成功率加成
        formula: "0"
        # 权限节点加成（按优先级匹配，高优先级先匹配）
        # 玩家拥有对应权限时获得额外加成
        permission-bonus:
            # SVIP玩家 +15% 成功率
            svip:
                permission: "mmoitems.upgrade.bonus.svip"
                bonus: 15
                priority: 30
            # VIP玩家 +10% 成功率
            vip:
                permission: "mmoitems.upgrade.bonus.vip"
                bonus: 10
                priority: 20
            # 普通玩家无额外加成
            default:
                permission: ""
                bonus: 0
                priority: 0
        # 最大额外加成上限（防止加成过高）
        max-bonus: 50

    # ===== 全局惩罚梯度配置 =====
    # 当物品未配置惩罚规则时，使用全局惩罚梯度
    # 优先级：物品配置 > 全局配置
    global-penalty:
        # 是否启用全局惩罚梯度（默认关闭，使用物品自身配置）
        enabled: false
        # 按等级段配置惩罚规则
        # 格式："起始等级-结束等级"
        tiers:
            # 0-5级：无惩罚
            "0-5":
                # 惩罚类型: none（无惩罚）、downgrade（降级）、break（碎裂）、destroy（销毁）
                type: "none"
            # 6-10级：10%概率降1级
            "6-10":
                type: "downgrade"
                chance: 0.1
                amount: 1
            # 11-15级：20%概率降1级，5%概率碎裂
            "11-15":
                type: "downgrade"
                chance: 0.2
                amount: 1
                # 碎裂概率（在降级判定后独立判定）
                break-chance: 0.05
            # 16-20级：30%概率降2级，10%概率碎裂
            "16-20":
                type: "downgrade"
                chance: 0.3
                amount: 2
                break-chance: 0.1
            # 21+级：50%概率降3级，20%概率碎裂
            "21+":
                type: "downgrade"
                chance: 0.5
                amount: 3
                break-chance: 0.2
            # 未匹配到等级段时的默认惩罚
            "default":
                type: "none"

    # ===== 强化等级转移配置 =====
    transfer:
        # 是否启用强化转移功能
        enabled: true
        # 转移模式: strict（仅同类型）或 loose（同类型/同父类型/父子类型）
        mode: "loose"
        # 转移比例（0-1，如 0.8 表示保留 80% 等级）
        ratio: 0.8
        # 最大可转移等级（-1 表示无限制）
        max-level: -1
        # 转移是否叠加到目标物品现有等级（true）还是覆盖（false）
        stack-mode: true
        # 转移后源物品等级是否重置为 0（true）还是保留（false）
        reset-source: true

    # ===== 强化等级转移类型兼容矩阵 =====
    # 仅在 transfer.mode = "whitelist" 时使用白名单判定
    # 否则按 strict/loose 模式判定
    transfer-compatibility:
        enabled: false
        allow-legacy-auto: true
        # 格式：FROM->TO，使用类型 ID，支持 ANY 通配；示例：SWORD->LONG_SWORD, ANY->STAFF
        whitelist: [ ]

# ===== 数据库设置（仅每日限制使用，跨服共享时启用）=====
database:
    daily-limit:
        enabled: false
        host: "127.0.0.1"
        port: 3306
        database: "mmoitems"
        user: "root"
        password: ""
        table: "mmoitems_daily_limit"
        pool-size: 5
        # 追加到 JDBC URL 的参数
        params: "useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC"

stats-displaying:

    # This will be a prefix to numeric stats,
    # changing their color when they are undesirable.
    color-positive: ''
    color-negative: ''

    # When items with RNG are displayed in crafting
    # stations, this is the separator between the low
    # and high bound:  Attack Damage  +5⎓7.5
    range-dash: '⎓'

soulbound:

    # Edit soulbound damage when players try to use
    # items which are not bound to themselves.
    damage:
        base: 1
        per-lvl: 1

    # Whether soulbound items should be
    # kept when a player dies.
    keep-on-death: true

    # [Experimental feature]
    # When toggled off, players cannot drop or take
    # Soulbound items away from their inventory.
    # Requires `keep-on-death` enabled.
    # Changes apply on server restart.
    can-drop: true

# 当物品带有 AUTO_BIND_ON_USE 属性且未显式设置 SOULBOUND_LEVEL 时，使用该默认等级进行绑定。
auto-bind:
    # 自动绑定默认等级（最小为 1）。当物品未配置 SOULBOUND_LEVEL 或其值 <= 0 时生效。
    default-level: 1

gem-sockets:

    # Define the text you need to enter the item
    # gem sockets if you want to create an uncolored
    # gem socket i.e a socket for any type of gem.
    uncolored: 'Uncolored'

custom-blocks:

    # Whether custom blocks should
    # generate in the world according to
    # their generation template.
    enable-world-gen: false

    # Whether to remove mushroom block drops
    # from the droplist when mining a mushroom block
    # with silk-touch.
    # HIGHLY Recommended for servers that use
    # custom blocks, as the mushroom blocks can BREAK everything.
    replace-mushroom-drops: true

# When set to true, players CANNOT upgrade an item if the
# specs (level, profession requirements) the item WOULD
# have if it were upgraded are too high for the player.
item-upgrade-requirements-check: true

# Players can't use their weapon/abilities when holding
# two-handed item and one other item simultaneously.
# When toggled off, players still receive slowness 4.
two-handed-item-restriction: true

# You can select what char will be used to create
# the item ability cooldown progress bar.
cooldown-progress-bar-char: █

# Displays a message on the action bar instead of on the chat.
# Can be used to reduce chat spam.
# Might interfere with other action bar plugins.
action-bar-display:
    ability-cooldown: true
    item-cooldown: true
    not-enough-mana: true
    not-enough-stamina: true
    two-handed: true
    cant-use-item: true
    mitigation: true
    item-break: false

recipes:

    # Enables the vanilla recipe book for MMOItems recipes
    use-recipe-book: true

# "repair" prevents players from repairing MMOItems.
# "smelt" prevents players from smelting MMOItems.
# 'enchant" disables enchanting for MMOItems.
# "craft" prevents players from using MMOItems as ingredients.
# "arrow-shooting" prevents players from shooting any MMOItem that is an arrow.
disable-interactions:
    interact: false
    repair: false
    enchant: false
    smelt: false
    smith: false
    craft: false
    arrow-shooting: false

# Block types that can't be broken by an ability/item effect
block-blacklist:
    - OBSIDIAN

# Allows/disables the permissions needed in order to use items/abilities.
# General permission node for abilities: mmoitems.ability.ability-id
# Ex: - mmoitems.ability.fire-meteor
#     - mmoitems.ability.slow
#     - mmoitems.ability.cursed-fangs
#     etc.
permissions:
    abilities: false
    items: true

#
# When item stats has a numeric range of possibilities.
# attack-damage:
#    base: 10
#    spread: 1
#
# Using the spread, a level, and a random number, we
# obtain a random number (very related to the spread): 1.7
#
# If additive-spread-formula is true, this is added to the base:
#    RESULT: 10 + 1.7  =  11.7 attack damage
#
# If additive-spread-formula is false, this is multiplied to the base:
#    RESULT: 10 * 1.7  =  17 attack damage
#
additive-spread-formula: false

# Disables non MMOItems from being crafted in the vanilla workbench.
# Add [] if the list is empty.
disable-vanilla-recipes: []
# - DIAMOND_PICKAXE
# - IRON_BLOCK

# Options for the Item Revision System
item-revision:

    # Unsocketing gems picks them up with the stats they had
    # when first put into the item, disable this option to
    # force them to be regenerated.
    regenerate-gems-when-unsocketed: false

    # Legacy option to carry tiers over, will take precedence
    # If not specified next to the other keep- flags.
    keep-tiers: true

    # If an item is updated, and the new version does not
    # keep its gems, this will give the gems back to the
    # player so that they don't get lost forever.
    drop-extra-gems: true

    # When keeping lore data, only lore that starts with this
    # will actually be kept.
    kept-lore-prefix: '&7'

    # Whether or not specific stats should be kept
    # when an item is updated to latest revision.
    keep-data:

        # Name of the item, usually renamed via anvil
        display-name: true

        # Enchantments put on the item by the player
        enchantments: true

        # Soulbound applied to the item
        soulbound: true

        # Gems on the item
        gems: true

        # Upgrade level of the item
        upgrades: true

        # Specific lore lines of the item...
        # Warning, this prevents stats in the lore from updating visually!
        lore: false

        # Data that may have been put there by external plugins.
        exsh: true

        # Stats handled by RNG will be rerolled
        reroll: false

        # Modifiers of items ~ Sharp, Light, Heavy, Arcane
        modifications: true

        # Skins applied by MMOItems
        skins: true

        # Tier of the item
        tier: true

        # Third party plugin compatibility
        advanced-enchantments: true

    # Whether specific stats should be kept when gemstones
    # within an item are updated to the latest revision.
    keep-gem-data:

        # Name of the item, usually renamed via anvil
        display-name: true

        # Enchantments put on the item by the player
        enchantments: true

        # Specific lore lines of the item...
        # Warning, this prevents stats in the lore from updating visually!
        lore: false

        # Stats handled by RNG will be rerolled
        reroll: false

    phat-loots:
        display-name: false
        enchantments: false
        soulbound: false
        gems: true
        upgrades: false
        lore: false
        exsh: false
        tier: true
        skins: false
        reroll: true
        modifications: false
        advanced-enchantments: false

    # These will not update at all in PhatLoots, for
    # compatibility with quest plugins that check for
    # exact NBT
    disable-phat-loot:
        - MANGO
        - STEEL_HELMET

    # Here you can disable individual events for when
    # Items should update when a higher revision ID is found
    disable-on:
        pickup: false
        craft: true # 'true' recommended
        click: false
        join: false

# Offset is the distance traveled on X and Y coordinates
# Height is the Y velocity coordinate. Lootsplosions
# only trigger with MythicMobs monsters.
# Changes apply on server restart.
lootsplosion:
    enabled: true
    color: true
    offset: .2
    height: .6

# When Upgrading meets Gems, one must decide if
# gems' stats will increase as well.
gem-upgrade-default: 'NEVER'

# This option allows you to disable the ability to
# use MMOItems that have been removed from your config.
disable-removed-items: true

# Default pickaxe power depending on the item material (for custom blocks only).
# Pickaxe power does not apply to vanilla blocks, only those from MMOItems.
# You may add/remove as many materials as you want in this list.
default-pickaxe-power:
    WOODEN_PICKAXE: 5
    STONE_PICKAXE: 10
    GOLDEN_PICKAXE: 15
    IRON_PICKAXE: 20
    DIAMOND_PICKAXE: 25
    NETHERITE_PICKAXE: 30
    # Add as many as you want.
